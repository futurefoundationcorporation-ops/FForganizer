Transformar este projeto em uma aplicaÃ§Ã£o 100% compatÃ­vel com deploy na Vercel, com seguranÃ§a profissional, utilizando Supabase + Vercel Serverless Functions, sem usar servidores persistentes (ex: Express/Node rodando).

NÃƒO APAGUE NENHUM ARQUIVO EXISTENTE, exceto .md redundantes â€” e somente se realmente forem inÃºteis.
Arquivos importantes .md devem ser preservados.

VocÃª deve:

ğŸŸ© 1. Manter todo o projeto como estÃ¡

NÃ£o remover pastas

NÃ£o deletar arquivos JS/TS, componentes, libs, hooks, utils

NÃ£o remover nada que afete a UI

SÃ³ pode remover arquivos .md redundantes, e mesmo assim apenas se nÃ£o forem Ãºteis.

ğŸŸ© 2. Migrar TODO o backend para Serverless Functions da Vercel

Criar estas rotas dentro de /api:

/api/login

Verifica MASTER_KEY (server-side, nunca no cliente)

Verifica access keys no Supabase (hash + salt)

Cria cookie seguro (HTTP-only, SameSite=Strict, Secure)

Retorna { ok, isAdmin }

/api/session

LÃª cookie

Valida

Retorna sessÃ£o

/api/generate-key (somente admin)

Cria key aleatÃ³ria

Gera salt

Gera hash seguro (scrypt/pbkdf2)

Armazena hash + salt

Retorna key apenas 1x

/api/list-keys (somente admin)
/api/delete-key (somente admin)
ğŸŸ© 3. Usar variÃ¡veis de ambiente da Vercel (Settings > Environment Variables)

Criar e usar apenas estas:

VITE_SUPABASE_URL
VITE_SUPABASE_ANON_KEY
SUPABASE_SERVICE_ROLE_KEY     â† sem VITE_
MASTER_KEY                    â† sem VITE_


MASTER_KEY nunca aparece no frontend.

ğŸŸ© 4. NÃ£o usar Express, nÃ£o usar servidor Replit

Tudo deve ser Vercel Serverless Function:

arquivos em /api/*.js

exportar async function handler(req, res) {} com a sintaxe atual da Vercel

usar cookies() da Next/Vercel para setar cookies

ğŸŸ© 5. Atualizar o frontend

Remover qualquer lÃ³gica de MASTER_KEY no cliente

Criar useAuth() para chamar /api/session

Criar UI de login que chama /api/login

Criar painel admin que usa /api/generate-key, /api/delete-key, /api/list-keys

Proteger rotas (simples: se !isAdmin, esconder opÃ§Ãµes)

ğŸŸ© 6. Supabase SQL 2025 â€” rodar sem erros

Usar como referÃªncia:

/mnt/data/SUPABASE_SCHEMA_SECURE_2025.sql

/mnt/data/SUPABASE_SCHEMA.md

/mnt/data/SUPABASE_SCHEMA_KEY_AUTH.md

/mnt/data/ADMIN_SETUP.md

VocÃª deve:

âœ” Validar todas as tabelas
âœ” Criar tabela access_keys (com key_hash, salt, label, revoked)
âœ” Criar polÃ­ticas RLS seguras
âœ” Criar RPCs com SECURITY DEFINER
âœ” NÃ£o usar nenhum comando proibido (app.jwt_secret, triggers antigos, etc.)

ğŸŸ© 7. ProteÃ§Ã£o Total

Implementar:

Cookies HTTP-only + Secure + SameSite=Strict

API protege MASTER_KEY

Todas as operaÃ§Ãµes sensÃ­veis sÃ£o pelo backend

Cliente nunca toca Supabase diretamente para chaves

access_keys fica com RLS USING (false)

Apenas RPCs e serverless acessam hash das chaves

ğŸŸ© 8. Limpeza de .MD

VocÃª pode remover apenas .md que:

duplicam informaÃ§Ãµes

nÃ£o sÃ£o mais usados

sÃ£o logs, rascunhos ou instruÃ§Ãµes antigas

Deve manter:

DocumentaÃ§Ã£o principal

Qualquer arquivo mencionado nos guias que forme parte da seguranÃ§a

QUALQUER .md que contiver SQL, regras RLS, ou instruÃ§Ãµes crÃ­ticas

ğŸŸ© 9. vercel.json

Criar (ou corrigir) para:

{
  "rewrites": [{ "source": "/(.*)", "destination": "/index.html" }],
  "outputDirectory": "dist",
  "buildCommand": "npm run build",
  "framework": "vite"
}

ğŸŸ© 10. No final vocÃª deve entregar:
âœ” CÃ³digo completo dos endpoints serverless
âœ” CÃ³digo atualizado do frontend
âœ” Novo README explicando como deployar na Vercel
âœ” SQL final pronto para colar no Supabase
âœ” Lista dos .md removidos
âœ” Lista dos .md mantidos
âœ” â€œChecklist finalâ€ de vercel environment variables
âœ” Teste final de login + geraÃ§Ã£o de chaves
ğŸŸ© 11. NUNCA quebrar o projeto existente

Tudo novo deve ser adicionado, nÃ£o substituÃ­do cegamente.

VocÃª pode:

sobrescrever arquivos que jÃ¡ existem somente se necessÃ¡rio

adicionar novos arquivos

atualizar imports conforme necessÃ¡rio

ğŸŸ© 12. Entrega Final

Seu output deve conter:

Todos os arquivos novos e atualizados

O SQL final

DiferenÃ§as entre antes/depois

InstruÃ§Ãµes para deploy na Vercel

SessÃ£o de testes funcionando

ğŸ”¥ ESTE Ã‰ O PROMPT OFICIAL. EXECUTE AGORA.
NÃ£o remova nada do projeto que nÃ£o seja EXTREMAMENTE necessÃ¡rio.
FaÃ§a a conversÃ£o completa para a Vercel com seguranÃ§a mÃ¡xima.