var U=s=>{throw TypeError(s)};var C=(s,e,t)=>e.has(s)||U("Cannot "+t);var n=(s,e,t)=>(C(s,e,"read from private field"),t?t.call(s):e.get(s)),y=(s,e,t)=>e.has(s)?U("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),g=(s,e,t,i)=>(C(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),f=(s,e,t)=>(C(s,e,"access private method"),t);import{g as L,s as q,h as O,i as T,n as I,k as R,r as v,l as V,m as G,j as r}from"./index-DfZjcx9l.js";import{u as Q,s as S,a as F}from"./useAdmin-DSchSF2S.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"c48c2e202b5c7f4d3a52ca8c9bf3af47df9a9fd3"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new s.Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="27cd2b09-0f4c-436e-8728-742f5ad6f925",s._sentryDebugIdIdentifier="sentry-dbid-27cd2b09-0f4c-436e-8728-742f5ad6f925")})()}catch{}var u,x,c,h,m,N,K,D,P=(D=class extends L{constructor(e,t){super();y(this,m);y(this,u);y(this,x);y(this,c);y(this,h);g(this,u,e),this.setOptions(t),this.bindMethods(),f(this,m,N).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var i;const t=this.options;this.options=n(this,u).defaultMutationOptions(e),q(this.options,t)||n(this,u).getMutationCache().notify({type:"observerOptionsUpdated",mutation:n(this,c),observer:this}),t!=null&&t.mutationKey&&this.options.mutationKey&&O(t.mutationKey)!==O(this.options.mutationKey)?this.reset():((i=n(this,c))==null?void 0:i.state.status)==="pending"&&n(this,c).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=n(this,c))==null||e.removeObserver(this)}onMutationUpdate(e){f(this,m,N).call(this),f(this,m,K).call(this,e)}getCurrentResult(){return n(this,x)}reset(){var e;(e=n(this,c))==null||e.removeObserver(this),g(this,c,void 0),f(this,m,N).call(this),f(this,m,K).call(this)}mutate(e,t){var i;return g(this,h,t),(i=n(this,c))==null||i.removeObserver(this),g(this,c,n(this,u).getMutationCache().build(n(this,u),this.options)),n(this,c).addObserver(this),n(this,c).execute(e)}},u=new WeakMap,x=new WeakMap,c=new WeakMap,h=new WeakMap,m=new WeakSet,N=function(){var t;const e=((t=n(this,c))==null?void 0:t.state)??T();g(this,x,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},K=function(e){I.batch(()=>{var t,i,o,d,l,b,_,A;if(n(this,h)&&this.hasListeners()){const p=n(this,x).variables,j=n(this,x).context,w={client:n(this,u),meta:this.options.meta,mutationKey:this.options.mutationKey};(e==null?void 0:e.type)==="success"?((i=(t=n(this,h)).onSuccess)==null||i.call(t,e.data,p,j,w),(d=(o=n(this,h)).onSettled)==null||d.call(o,e.data,null,p,j,w)):(e==null?void 0:e.type)==="error"&&((b=(l=n(this,h)).onError)==null||b.call(l,e.error,p,j,w),(A=(_=n(this,h)).onSettled)==null||A.call(_,void 0,e.error,p,j,w))}this.listeners.forEach(p=>{p(n(this,x))})})},D);function M(s,e){const t=R(),[i]=v.useState(()=>new P(t,s));v.useEffect(()=>{i.setOptions(s)},[i,s]);const o=v.useSyncExternalStore(v.useCallback(l=>i.subscribe(I.batchCalls(l)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),d=v.useCallback((l,b)=>{i.mutate(l,b).catch(V)},[i]);if(o.error&&G(i.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:d,mutateAsync:o.mutate}}const H=()=>{const s=R(),{data:e,isLoading:t,error:i}=Q({queryKey:["accessKeys"],queryFn:async()=>{const{data:d,error:l}=await S.from("access_keys").select("*").order("created_at",{ascending:!1});if(l)throw new Error(l.message);return d}}),o=M({mutationFn:async d=>{const{data:l,error:b}=await S.from("access_keys").update({is_revoked:!0}).eq("id",d);if(b)throw new Error(b.message);return l},onSuccess:()=>{s.invalidateQueries({queryKey:["accessKeys"]})}});return t?r.jsx("div",{children:"Carregando chaves..."}):i?r.jsxs("div",{children:["Erro ao carregar chaves: ",i.message]}):r.jsxs("div",{className:"mt-8",children:[r.jsx("h2",{className:"text-xl font-semibold",children:"Chaves de Acesso Existentes"}),r.jsxs("div",{className:"mt-4 overflow-x-auto",children:[r.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-2 border-b text-left",children:"Chave"}),r.jsx("th",{className:"px-4 py-2 border-b text-left",children:"Status"}),r.jsx("th",{className:"px-4 py-2 border-b text-left",children:"Criada em"}),r.jsx("th",{className:"px-4 py-2 border-b text-left",children:"Ações"})]})}),r.jsx("tbody",{children:e.map(d=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-4 py-2 border-b font-mono text-sm",children:d.key}),r.jsx("td",{className:"px-4 py-2 border-b",children:r.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${d.is_revoked?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:d.is_revoked?"Revogada":"Ativa"})}),r.jsx("td",{className:"px-4 py-2 border-b text-sm",children:new Date(d.created_at).toLocaleString()}),r.jsx("td",{className:"px-4 py-2 border-b",children:!d.is_revoked&&r.jsx("button",{onClick:()=>o.mutate(d.id),disabled:o.isLoading,className:"px-3 py-1 text-sm font-medium text-red-600 hover:text-red-800 disabled:text-gray-400",children:"Revogar"})})]},d.id))})]}),o.isError&&r.jsxs("div",{className:"mt-2 text-red-500",children:["Erro ao revogar chave: ",o.error.message]})]})]})};let E;const Y=new Uint8Array(16);function $(){if(!E&&(E=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!E))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return E(Y)}const a=[];for(let s=0;s<256;++s)a.push((s+256).toString(16).slice(1));function z(s,e=0){return a[s[e+0]]+a[s[e+1]]+a[s[e+2]]+a[s[e+3]]+"-"+a[s[e+4]]+a[s[e+5]]+"-"+a[s[e+6]]+a[s[e+7]]+"-"+a[s[e+8]]+a[s[e+9]]+"-"+a[s[e+10]]+a[s[e+11]]+a[s[e+12]]+a[s[e+13]]+a[s[e+14]]+a[s[e+15]]}const B=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),k={randomUUID:B};function J(s,e,t){if(k.randomUUID&&!s)return k.randomUUID();s=s||{};const i=s.random||(s.rng||$)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,z(i)}const W=()=>{const s=R(),e=M({mutationFn:async()=>{const t=J(),{data:i,error:o}=await S.from("access_keys").insert([{key:t,is_revoked:!1}]).select();if(o)throw new Error(o.message);return i},onSuccess:()=>{s.invalidateQueries({queryKey:["accessKeys"]})}});return r.jsxs("div",{className:"mt-8",children:[r.jsx("h2",{className:"text-xl font-semibold",children:"Gerar Nova Chave"}),r.jsx("button",{onClick:()=>e.mutate(),disabled:e.isLoading,className:"mt-4 px-4 py-2 bg-primary text-white font-semibold rounded-md hover:bg-primary-dark disabled:bg-gray-400",children:e.isLoading?"Gerando...":"Gerar Nova Chave de Acesso"}),e.isError&&r.jsxs("div",{className:"mt-2 text-red-500",children:["Erro ao gerar chave: ",e.error.message]})]})},se=()=>{const{isAdmin:s,isLoading:e,error:t}=F();return e?r.jsx("div",{children:"Verificando permissões..."}):t?r.jsxs("div",{children:["Erro ao verificar permissões: ",t.message]}):s?r.jsxs("div",{className:"p-8",children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Painel de Administração"}),r.jsx("p",{className:"mt-2",children:"Gere e gerencie as chaves de acesso para a sua aplicação."}),r.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsx("div",{children:r.jsx(W,{})}),r.jsx("div",{children:r.jsx(H,{})})]})]}):r.jsx("div",{children:"Acesso negado. Você não tem permissão para acessar esta página."})};export{se as default};
//# sourceMappingURL=Admin-C-gFDp8j.js.map
