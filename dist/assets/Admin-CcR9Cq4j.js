var k=s=>{throw TypeError(s)};var N=(s,e,t)=>e.has(s)||k("Cannot "+t);var a=(s,e,t)=>(N(s,e,"read from private field"),t?t.call(s):e.get(s)),x=(s,e,t)=>e.has(s)?k("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),y=(s,e,t,i)=>(N(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),g=(s,e,t)=>(N(s,e,"access private method"),t);import{r as v,j as r}from"./index-DUw6uZId.js";import{S as V,s as D,h as L,n as q,b as A,c as I,d as U,u as G,e as S,a as Q}from"./useAdmin-B4gEyBGw.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"f1bf8d91ca71e7c90b2c75a3140c16f3a9b2413f"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},e=new s.Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="80ab39d8-482a-4dc7-9e55-75ef5c442fba",s._sentryDebugIdIdentifier="sentry-dbid-80ab39d8-482a-4dc7-9e55-75ef5c442fba")})()}catch{}function F(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var u,m,c,h,f,C,K,M,P=(M=class extends V{constructor(e,t){super();x(this,f);x(this,u);x(this,m);x(this,c);x(this,h);y(this,u,e),this.setOptions(t),this.bindMethods(),g(this,f,C).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var i;const t=this.options;this.options=a(this,u).defaultMutationOptions(e),D(this.options,t)||a(this,u).getMutationCache().notify({type:"observerOptionsUpdated",mutation:a(this,c),observer:this}),t!=null&&t.mutationKey&&this.options.mutationKey&&L(t.mutationKey)!==L(this.options.mutationKey)?this.reset():((i=a(this,c))==null?void 0:i.state.status)==="pending"&&a(this,c).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=a(this,c))==null||e.removeObserver(this)}onMutationUpdate(e){g(this,f,C).call(this),g(this,f,K).call(this,e)}getCurrentResult(){return a(this,m)}reset(){var e;(e=a(this,c))==null||e.removeObserver(this),y(this,c,void 0),g(this,f,C).call(this),g(this,f,K).call(this)}mutate(e,t){var i;return y(this,h,t),(i=a(this,c))==null||i.removeObserver(this),y(this,c,a(this,u).getMutationCache().build(a(this,u),this.options)),a(this,c).addObserver(this),a(this,c).execute(e)}},u=new WeakMap,m=new WeakMap,c=new WeakMap,h=new WeakMap,f=new WeakSet,C=function(){var t;const e=((t=a(this,c))==null?void 0:t.state)??F();y(this,m,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},K=function(e){q.batch(()=>{var t,i,o,d,l,b,_,O;if(a(this,h)&&this.hasListeners()){const p=a(this,m).variables,j=a(this,m).context,w={client:a(this,u),meta:this.options.meta,mutationKey:this.options.mutationKey};(e==null?void 0:e.type)==="success"?((i=(t=a(this,h)).onSuccess)==null||i.call(t,e.data,p,j,w),(d=(o=a(this,h)).onSettled)==null||d.call(o,e.data,null,p,j,w)):(e==null?void 0:e.type)==="error"&&((b=(l=a(this,h)).onError)==null||b.call(l,e.error,p,j,w),(O=(_=a(this,h)).onSettled)==null||O.call(_,void 0,e.error,p,j,w))}this.listeners.forEach(p=>{p(a(this,m))})})},M);function T(s,e){const t=A(),[i]=v.useState(()=>new P(t,s));v.useEffect(()=>{i.setOptions(s)},[i,s]);const o=v.useSyncExternalStore(v.useCallback(l=>i.subscribe(q.batchCalls(l)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),d=v.useCallback((l,b)=>{i.mutate(l,b).catch(I)},[i]);if(o.error&&U(i.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:d,mutateAsync:o.mutate}}const $=()=>{const s=A(),{data:e,isLoading:t,error:i}=G({queryKey:["accessKeys"],queryFn:async()=>{const{data:d,error:l}=await S.from("access_keys").select("*").order("created_at",{ascending:!1});if(l)throw new Error(l.message);return d}}),o=T({mutationFn:async d=>{const{data:l,error:b}=await S.from("access_keys").update({is_revoked:!0}).eq("id",d);if(b)throw new Error(b.message);return l},onSuccess:()=>{s.invalidateQueries({queryKey:["accessKeys"]})}});return t?r.jsx("div",{children:"Carregando chaves..."}):i?r.jsxs("div",{children:["Erro ao carregar chaves: ",i.message]}):r.jsxs("div",{className:"mt-8",children:[r.jsx("h2",{className:"text-xl font-semibold",children:"Chaves de Acesso Existentes"}),r.jsxs("div",{className:"mt-4 overflow-x-auto",children:[r.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-2 border-b text-left",children:"Chave"}),r.jsx("th",{className:"px-4 py-2 border-b text-left",children:"Status"}),r.jsx("th",{className:"px-4 py-2 border-b text-left",children:"Criada em"}),r.jsx("th",{className:"px-4 py-2 border-b text-left",children:"Ações"})]})}),r.jsx("tbody",{children:e.map(d=>r.jsxs("tr",{children:[r.jsx("td",{className:"px-4 py-2 border-b font-mono text-sm",children:d.key}),r.jsx("td",{className:"px-4 py-2 border-b",children:r.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${d.is_revoked?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:d.is_revoked?"Revogada":"Ativa"})}),r.jsx("td",{className:"px-4 py-2 border-b text-sm",children:new Date(d.created_at).toLocaleString()}),r.jsx("td",{className:"px-4 py-2 border-b",children:!d.is_revoked&&r.jsx("button",{onClick:()=>o.mutate(d.id),disabled:o.isLoading,className:"px-3 py-1 text-sm font-medium text-red-600 hover:text-red-800 disabled:text-gray-400",children:"Revogar"})})]},d.id))})]}),o.isError&&r.jsxs("div",{className:"mt-2 text-red-500",children:["Erro ao revogar chave: ",o.error.message]})]})]})};var E,H=new Uint8Array(16);function X(){if(!E&&(E=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!E))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return E(H)}const Y=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function z(s){return typeof s=="string"&&Y.test(s)}var n=[];for(var R=0;R<256;++R)n.push((R+256).toString(16).substr(1));function B(s){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(n[s[e+0]]+n[s[e+1]]+n[s[e+2]]+n[s[e+3]]+"-"+n[s[e+4]]+n[s[e+5]]+"-"+n[s[e+6]]+n[s[e+7]]+"-"+n[s[e+8]]+n[s[e+9]]+"-"+n[s[e+10]]+n[s[e+11]]+n[s[e+12]]+n[s[e+13]]+n[s[e+14]]+n[s[e+15]]).toLowerCase();if(!z(t))throw TypeError("Stringified UUID is invalid");return t}function J(s,e,t){s=s||{};var i=s.random||(s.rng||X)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,B(i)}const W=()=>{const s=A(),e=T({mutationFn:async()=>{const t=J(),{data:i,error:o}=await S.from("access_keys").insert([{key:t,is_revoked:!1}]).select();if(o)throw new Error(o.message);return i},onSuccess:()=>{s.invalidateQueries({queryKey:["accessKeys"]})}});return r.jsxs("div",{className:"mt-8",children:[r.jsx("h2",{className:"text-xl font-semibold",children:"Gerar Nova Chave"}),r.jsx("button",{onClick:()=>e.mutate(),disabled:e.isLoading,className:"mt-4 px-4 py-2 bg-primary text-white font-semibold rounded-md hover:bg-primary-dark disabled:bg-gray-400",children:e.isLoading?"Gerando...":"Gerar Nova Chave de Acesso"}),e.isError&&r.jsxs("div",{className:"mt-2 text-red-500",children:["Erro ao gerar chave: ",e.error.message]})]})},te=()=>{const{isAdmin:s,isLoading:e,error:t}=Q();return e?r.jsx("div",{children:"Verificando permissões..."}):t?r.jsxs("div",{children:["Erro ao verificar permissões: ",t.message]}):s?r.jsxs("div",{className:"p-8",children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Painel de Administração"}),r.jsx("p",{className:"mt-2",children:"Gere e gerencie as chaves de acesso para a sua aplicação."}),r.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-8",children:[r.jsx("div",{children:r.jsx(W,{})}),r.jsx("div",{children:r.jsx($,{})})]})]}):r.jsx("div",{children:"Acesso negado. Você não tem permissão para acessar esta página."})};export{te as default};
//# sourceMappingURL=Admin-CcR9Cq4j.js.map
